----
title: 緊耦合架構
date: 2022-04-13 13:53
modified: 2022-04-13 13:53
tags: 標籤
category: 後端程式
slug: 自定義URL標籤
summary: 預覽標題
image: /images/default_preview_image.jpg
status: draft
---

[TOC]

![[標準的三層式架構圖|800]]


從書中的範例，三層式架構如下圖，就是很標準的像是我們現在寫程式的分層架構，但是依賴關係就完全是上面左邊的依賴關係說明

![[程式架構圖範例.jpg]]


業務邏輯層
```C#
public class ProductService : IDisposable
    {
        private readonly CommerceContext dbContext;

        public ProductService()
        {
            this.dbContext = new CommerceContext();
        }

        public IEnumerable<Product> GetFeaturedProducts(
            bool isCustomerPreferred)
        {
            decimal discount =
                isCustomerPreferred ? .95m : 1;

            var featuredProducts =
                from product in this.dbContext.Products
                where product.IsFeatured
                select product;

            return
                from product in featuredProducts.AsEnumerable()
                select new Product
                {
                    Id = product.Id,
                    Name = product.Name,
                    Description = product.Description,
                    IsFeatured = product.IsFeatured,
                    UnitPrice =
                        product.UnitPrice * discount
                };
        }
        public void Dispose()
        {
            this.Dispose(true);
            GC.SuppressFinalize(this);
        }
        protected virtual void Dispose(bool disposing)
        {
            if (disposing)
            {
                this.dbContext.Dispose();
            }
        }
    }
```



展示層

```c#
public class HomeController : Controller
{// ---- Start code Listing 2.4 ----
	public ViewResult Index()
	{
		bool isPreferredCustomer =
			this.User.IsInRole("PreferredCustomer");

		var service = new ProductService();

		var products = service.GetFeaturedProducts(
			isPreferredCustomer);

		this.ViewData["Products"] = products;
		return this.View();
	}
}
```



資料層
``` c#
public class CommerceContext : DbContext
    {
        public DbSet<Product> Products { get; set; }
        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
        {
            var config = new ConfigurationBuilder()
                .SetBasePath(Directory.GetCurrentDirectory())
                .AddJsonFile("appsettings.json")
                .Build();
            string connectionString =
                config.GetConnectionString(
                    "CommerceConnectionString");
            optionsBuilder.UseSqlite(connectionString);
        }
    }
```


---

### 對依賴關係的剖析：


`public IEnumerable<Product> GetFeaturedProducts(bool isCustomerPreferred)`

ProductService 類別中，GetFeaturedProducts方法會回傳一串商品資訊物件Product是定義在資料層，所以GetFeaturedProducts方法 必定依賴資料層

ProductService建構子中 new CommerceContext()，使得這個業務邏輯層又直接耦合資料層，無法做程式碼介入攔截替換其他實作

---

DI的優點：

- 晚期繫結
- 可擴展性
- 可維護性
- 平行開發
- 可測試性

以上的優點在此範例完全無法享受到優點