---
title: 委派
date: 2023-03-27 15:05
modified: 2023-03-27 15:05
tags: 標籤
category: 後端程式
slug: 自定義URL標籤
summary: 預覽標題
image: /images/default_preview_image.jpg
status: draft
---

[TOC]

## 定義


在 C# 中，委派（Delegate）是一個類型（Type），==它可以將方法（Method）作為一個物件（Object）進行傳遞==。它代表了一個可以存儲方法引用的物件，可以被當作參數傳遞給其他方法，也可以被當作方法的返回值返回。委派的聲明類型包含方法的簽名，並且在呼叫委派時，它會調用該簽名相符合的方法。

在 C# 中，委派有多種類型，包括以下幾種：

1.  Action：不返回任何值的委派，最多可以有 16 個輸入參數。
2.  Func：返回單個值的委派，最多可以有 16 個輸入參數。
3.  Predicate：返回布林值的委派，只有一個輸入參數。
4.  EventHandler：處理事件的委派，通常使用兩個輸入參數，一個是 object 類型的 sender，另一個是 EventArgs 類型的 e。
5.  自定義委派：使用 delegate 關鍵字可以聲明自定義委派類型，可以指定輸入參數和返回類型，也可以不指定。

每個委派類型都定義了一個簽名（signature），即它所代表的方法的輸入和輸出參數。使用不同的委派類型可以簡化程式碼，提高代碼的可讀性和可維護性。

---


委派（Delegate）可以提供許多好處，包括：

1.  設計模式的實現：委派可以實現設計模式中的[[觀察者模式]]、[[策略模式]]等，使代碼更加模塊化和可重用。
    
2.  異步編程：委派可以用於異步編程中，例如使用 AsyncCallback 委派處理異步操作的回調函數，或使用 Func 和 Action 委派進行非同步操作。
    
3.  事件處理：委派可以用於定義事件的處理方法，使得事件的發生與處理解耦合。
    
4.  可插拔的架構：委派可以用於實現可插拔的架構，例如將方法作為參數傳遞給另一個方法，使得方法的實現可以動態地改變。

範例：

```c#
public class CacheManager
{
    private readonly ThreadLocal<Dictionary<string, object>> _cache = new ThreadLocal<Dictionary<string, object>>(
        () => new Dictionary<string, object>());

    public object Get(string key)
    {
        _cache.Value.TryGetValue(key, out object value);
        return value;
    }

    public void Set(string key, object value)
    {
        _cache.Value[key] = value;
    }
}
```