<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Richard隨手筆記 - Mac</title><link href="https://richardrobot.xyz/" rel="alternate"></link><link href="https://richardrobot.xyz/feeds/mac.atom.xml" rel="self"></link><id>https://richardrobot.xyz/</id><updated>2021-10-28T07:50:00+08:00</updated><subtitle>紙上得來終覺淺，絕知此事要躬行</subtitle><entry><title>MacM1執行Tensorflow錯誤問題</title><link href="https://richardrobot.xyz/2021/10/mac-tensorflow/" rel="alternate"></link><published>2021-10-28T07:50:00+08:00</published><updated>2021-10-28T07:50:00+08:00</updated><author><name>Richard</name></author><id>tag:richardrobot.xyz,2021-10-28:/2021/10/mac-tensorflow/</id><summary type="html">&lt;p&gt;MacM1執行Tensorflow2.6出現錯誤&lt;/p&gt;</summary><content type="html">&lt;p&gt;每當執行如下的語法時：
&lt;code&gt;model.fit(x_train, y_train, epochs=5)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;就會出現以下錯誤：
&amp;#8220;`java
2021-10-27 20:36:06.945996: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:185] None of the &lt;span class="caps"&gt;MLIR&lt;/span&gt; Optimization Passes are enabled (registered&amp;nbsp;2)&lt;/p&gt;
&lt;p&gt;2021-10-27 20:36:06.948454: W tensorflow/core/platform/profile_utils/cpu_utils.cc:128] Failed to get &lt;span class="caps"&gt;CPU&lt;/span&gt; frequency: 0&amp;nbsp;Hz&lt;/p&gt;
&lt;p&gt;Epoch&amp;nbsp;1/5&lt;/p&gt;
&lt;p&gt;2021-10-27 20:36:07.052295: I tensorflow/core/grappler/optimizers/custom_graph_optimizer_registry.cc:112] Plugin optimizer for device_type &lt;span class="caps"&gt;GPU&lt;/span&gt; is&amp;nbsp;enabled.&lt;/p&gt;
&lt;p&gt;2021-10-27 20:36:07.079 python[8109:118092] -[MPSGraph adamUpdateWithLearningRateTensor:beta1Tensor:beta2Tensor:epsilonTensor:beta1PowerTensor:beta2PowerTensor:valuesTensor:momentumTensor:velocityTensor:maximumVelocityTensor:gradientTensor:name:]: unrecognized selector sent to instance&amp;nbsp;0x29ee0f660&lt;/p&gt;
&lt;p&gt;2021-10-27 20:36:07.091 python[8109:118092] *** Terminating app due to uncaught exception &amp;#8216;NSInvalidArgumentException&amp;#8217;, reason: &amp;#8216;-[MPSGraph adamUpdateWithLearningRateTensor:beta1Tensor:beta2Tensor:epsilonTensor:beta1PowerTensor:beta2PowerTensor:valuesTensor:momentumTensor:velocityTensor:maximumVelocityTensor:gradientTensor:name:]: unrecognized selector sent to instance&amp;nbsp;0x29ee0f660&amp;#8217;&lt;/p&gt;
&lt;p&gt;&lt;span class="dquo"&gt;&amp;#8220;&lt;/span&gt;`&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;一開始以爲是只能執行在Python 3.8的環境，但是參考教學 https://www.youtube.com/watch?v=_CO-&lt;span class="caps"&gt;ND1FTOU&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;影片中也是能夠在Python3.9使用Tensorflow2.5，使用以下語法查看版本&lt;/p&gt;
&lt;p&gt;&lt;span class="dquo"&gt;&amp;#8220;&lt;/span&gt;`
import&amp;nbsp;sys&lt;/p&gt;
&lt;p&gt;import tensorflow.keras
import pandas as pd
import sklearn as sk
import tensorflow as&amp;nbsp;tf&lt;/p&gt;
&lt;p&gt;print(f&amp;#8221;Tensor Flow Version: {tf.&lt;strong&gt;version&lt;/strong&gt;}&amp;#8221;)
print(f&amp;#8221;Keras Version: {tensorflow.keras.&lt;strong&gt;version&lt;/strong&gt;}&amp;#8221;)
print()
print(f&amp;#8221;Python {sys.version}&amp;#8221;)
print(f&amp;#8221;Pandas {pd.&lt;strong&gt;version&lt;/strong&gt;}&amp;#8221;)
print(f&amp;#8221;Scikit-Learn {sk.&lt;strong&gt;version&lt;/strong&gt;}&amp;#8221;)
gpu = len(tf.config.list_physical_devices(&amp;#8216;&lt;span class="caps"&gt;GPU&lt;/span&gt;&amp;#8217;))&amp;gt;0
print(&amp;#8220;&lt;span class="caps"&gt;GPU&lt;/span&gt; is&amp;#8221;, &amp;#8220;available&amp;#8221; if gpu else &amp;#8220;&lt;span class="caps"&gt;NOT&lt;/span&gt; &lt;span class="caps"&gt;AVAILABLE&lt;/span&gt;&amp;#8221;)&lt;/p&gt;
&lt;p&gt;&lt;span class="dquo"&gt;&amp;#8220;&lt;/span&gt;`&lt;/p&gt;
&lt;p&gt;Tensor Flow Version: 2.6.0
Keras Version:&amp;nbsp;2.6.0&lt;/p&gt;
&lt;p&gt;Python 3.9.6 | packaged by conda-forge | (default, Jul 11 2021, 03:35:11) 
[Clang 11.1.0 ]
Pandas 1.3.0
Scikit-Learn 0.24.2
&lt;span class="caps"&gt;GPU&lt;/span&gt; is&amp;nbsp;available&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;用另外一個環境一樣Python3.9，TensorFlow2.5就可以正確執行，看來需要降版本，只好先移除了&lt;/p&gt;
&lt;p&gt;安裝參考：
&lt;a href="https://developer.apple.com/metal/tensorflow-plugin/"&gt;tensorflow-metal PluggableDevice&amp;nbsp;入門&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://makeoptim.com/deep-learning/tensorflow-metal"&gt;&lt;span class="caps"&gt;AI&lt;/span&gt; - Apple Silicon Mac M1 原生支持 TensorFlow 2.6 &lt;span class="caps"&gt;GPU&lt;/span&gt; 加速（tensorflow-metal&amp;nbsp;PluggableDevice）&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;參考第二個連接的處理，重新安裝 Xcode&amp;nbsp;，並且重新執行安裝語法就OK了&lt;/p&gt;
&lt;p&gt;先解除安裝
&lt;code&gt;python -m pip uninstall tensorflow-macos&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;python -m pip uninstall tensorflow-metal&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;執行重新安裝
&lt;code&gt;conda install -c apple tensorflow-deps --force-reinstall&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;python -m pip install tensorflow-macos&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;python -m pip install tensorflow-metal&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;測試語法：&lt;/p&gt;
&lt;p&gt;&lt;span class="dquo"&gt;&amp;#8220;&lt;/span&gt;`
from tensorflow.keras import layers
from tensorflow.keras import models
model = models.Sequential()
model.add(layers.Conv2D(32, (3, 3), activation=&amp;#8217;relu&amp;#8217;, input_shape=(28, 28, 1)))
model.add(layers.MaxPooling2D((2, 2)))
model.add(layers.Conv2D(64, (3, 3), activation=&amp;#8217;relu&amp;#8217;))
model.add(layers.MaxPooling2D((2, 2)))
model.add(layers.Conv2D(64, (3, 3), activation=&amp;#8217;relu&amp;#8217;))
model.add(layers.Flatten())
model.add(layers.Dense(64, activation=&amp;#8217;relu&amp;#8217;))
model.add(layers.Dense(10, activation=&amp;#8217;softmax&amp;#8217;))&amp;nbsp;model.summary()&lt;/p&gt;
&lt;p&gt;&lt;span class="dquo"&gt;&amp;#8220;&lt;/span&gt;`&lt;/p&gt;
&lt;p&gt;&lt;code&gt;from tensorflow.keras.datasets import mnist
from tensorflow.keras.utils import to_categorical
(train_images, train_labels), (test_images, test_labels) = mnist.load_data()
train_images = train_images.reshape((60000, 28, 28, 1))
train_images = train_images.astype('float32') / 255
test_images = test_images.reshape((10000, 28, 28, 1))
test_images = test_images.astype('float32') / 255
train_labels = to_categorical(train_labels)
test_labels = to_categorical(test_labels)
model.compile(optimizer='rmsprop',
              loss='categorical_crossentropy',
              metrics=['accuracy'])
model.fit(train_images, train_labels, epochs=5, batch_size=64)
test_loss, test_acc = model.evaluate(test_images, test_labels)
test_acc&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;上面處理已經完成但是會引發一個問題：&lt;/p&gt;
&lt;p&gt;numpy&amp;nbsp;會被安裝成0.19的版本，而且會造成錯誤：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;java
ValueError:
numpy.ndarray size changed, may indicate binary incompatibility. Expected 88 from C header, got 80 from PyObject&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;需要再更新Numpy
&lt;code&gt;python
pip install --upgrade numpy&lt;/code&gt;&lt;/p&gt;</content><category term="Mac"></category><category term="Tensorflow"></category></entry><entry><title>安裝Let’s Encrypt電子證書</title><link href="https://richardrobot.xyz/2021/10/mac-lets-encrypt/" rel="alternate"></link><published>2021-10-08T18:45:00+08:00</published><updated>2021-10-08T18:45:00+08:00</updated><author><name>Richard</name></author><id>tag:richardrobot.xyz,2021-10-08:/2021/10/mac-lets-encrypt/</id><summary type="html">&lt;p&gt;在Mac本機安裝SSL與驗證流程記錄&lt;/p&gt;</summary><content type="html">&lt;p&gt;參考資料：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://yinlei.org/x-plane10/big5.php?p=2017/01/lets-encrypt.html"&gt;安裝Let&amp;#8217;s&amp;nbsp;Encrypt電子證書&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://jerry.thesolarsystems.net/?p=885"&gt;如何在NGINX+DJANGO平台設置SSL連線&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在本機驗證安裝Let&amp;#8217;s&amp;nbsp;Encrypt&lt;/p&gt;
&lt;p&gt;&lt;code&gt;brew install certbot&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;brew ls certbot&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;然後在Mac執行  &lt;/p&gt;
&lt;p&gt;&lt;code&gt;certbot --config-dir ~/letsencrypt/etc --work-dir ~/letsencrypt/lib --logs-dir ~/letsencrypt/log certonly --manual&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;接下來會有三個步驟要輸入：&lt;/p&gt;
&lt;p&gt;1.Email&lt;/p&gt;
&lt;p&gt;2.domain&lt;/p&gt;
&lt;p&gt;3.會要你在規定的路徑上產生讀取文檔：&lt;/p&gt;
&lt;p&gt;&lt;span class="dquo"&gt;&amp;#8220;&lt;/span&gt;`python&lt;/p&gt;
&lt;p&gt;Saving debug log to&amp;nbsp;/Users/jarvis.zheng/letsencrypt/log/letsencrypt.log&lt;/p&gt;
&lt;p&gt;Please enter the domain name(s) you would like on your certificate (comma&amp;nbsp;and/or&lt;/p&gt;
&lt;p&gt;space separated) (Enter &amp;#8216;c&amp;#8217; to cancel):&amp;nbsp;linebot.richardrobot.xyz&lt;/p&gt;
&lt;p&gt;Requesting a certificate for&amp;nbsp;linebot.richardrobot.xyz&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Create a file containing just this&amp;nbsp;data:&lt;/p&gt;
&lt;p&gt;YYUCwTYHewbZ0vVcobFBA8kmL-xs-8AQAj5aH7tD3HI.mFCPG4KMVD6yTJlxRiPv1IXrYQENjpRSb9DJyynjW5I&lt;/p&gt;
&lt;p&gt;And make it available on your web server at this &lt;span class="caps"&gt;URL&lt;/span&gt;:&lt;/p&gt;
&lt;p&gt;http://linebot.richardrobot.xyz/.well-known/acme-challenge/YYUCwTYHewbZ0vVcobFBA8kmL-xs-8AQAj5aH7tD3HI&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Press Enter to&amp;nbsp;Continue&lt;/p&gt;
&lt;p&gt;&lt;span class="dquo"&gt;&amp;#8220;&lt;/span&gt;`&lt;/p&gt;
&lt;p&gt;從上面的指示來看&amp;nbsp;要在指定的網址：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;http://linebot.richardrobot.xyz/.well-known/acme-challenge/YYUCwTYHewbZ0vVcobFBA8kmL-xs-8AQAj5aH7tD3HI&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;產生可讀取字串：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;YYUCwTYHewbZ0vVcobFBA8kmL-xs-8AQAj5aH7tD3HI.mFCPG4KMVD6yTJlxRiPv1IXrYQENjpRSb9DJyynjW5I&lt;/code&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;h2 id="django"&gt;在Django的做法如下：&lt;/h2&gt;
&lt;p&gt;在 url.py&amp;nbsp;設定網址：&lt;/p&gt;
&lt;p&gt;&lt;img alt="url設定的圖片.png" src="https://richardrobot.xyz/images/url設定的圖片.png" /&gt;&lt;/p&gt;
&lt;p&gt;檔案放置的地方：
&lt;img alt="檔案放置的地方.png" src="https://richardrobot.xyz/images/檔案放置的地方.png" /&gt;&lt;/p&gt;
&lt;p&gt;Views.py 程式讀取的方式：
&lt;img alt="views程式讀取的方式.png" src="https://richardrobot.xyz/images/views程式讀取的方式.png" /&gt;&lt;/p&gt;
&lt;p&gt;驗證成功存放的路徑：
&lt;img alt="驗證成功的畫面.png" src="https://richardrobot.xyz/images/驗證成功的畫面.png" /&gt;&lt;/p&gt;
&lt;p&gt;nginx 新增的配置&amp;nbsp;&amp;#8220;`c&lt;/p&gt;
&lt;p&gt;第一個
server&amp;nbsp;{&lt;/p&gt;
&lt;p&gt;server_name&amp;nbsp;linebot.richardrobot.xyz;&lt;/p&gt;
&lt;p&gt;listen&amp;nbsp;80;&lt;/p&gt;
&lt;p&gt;return 301&amp;nbsp;https://linebot.richardrobot.xyz$request_uri;&lt;/p&gt;
&lt;p&gt;}&lt;/p&gt;
&lt;p&gt;第二個&amp;nbsp;server{&lt;/p&gt;
&lt;p&gt;listen&amp;nbsp;443;&lt;/p&gt;
&lt;p&gt;server_name&amp;nbsp;linebot.richardrobot.xyz;&lt;/p&gt;
&lt;p&gt;ssl on; #&amp;nbsp;&amp;lt;-&lt;/p&gt;
&lt;p&gt;ssl_certificate /Users/jarvis.zheng/LineBot/ssl/cert.pem; #&amp;nbsp;&amp;lt;-&lt;/p&gt;
&lt;p&gt;ssl_certificate /Users/jarvis.zheng/LineBot/ssl/chain.pem; #&amp;nbsp;&amp;lt;-&lt;/p&gt;
&lt;p&gt;ssl_certificate_key /Users/jarvis.zheng/LineBot/ssl/privkey.pem; #&amp;nbsp;&amp;lt;-&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;location / {

    #第三個
    proxy_set_header X-Forwarded-Proto https; # &amp;lt;-這個很重要，記得加入


}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;}&lt;/p&gt;
&lt;p&gt;&lt;span class="dquo"&gt;&amp;#8220;&lt;/span&gt;`&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;code&gt;沒有加最後的分號 ; 
(LineBot) jarvis.zheng@zhengruichangdeMac-mini LineBot % sudo nginx -s reload
Password:
nginx: [warn] the "ssl" directive is deprecated, use the "listen ... ssl" directive instead in /opt/homebrew/etc/nginx/sites-enabled/LineBot:5
nginx: [emerg] no "ssl_certificate_key" is defined for certificate "/Users/jarvis.zheng/LineBot/ssl/chain.pem" and the "ssl" directive in /opt/homebrew/etc/nginx/sites-enabled/LineBot:5&lt;/code&gt;&lt;/p&gt;</content><category term="Mac"></category><category term="ssl"></category></entry><entry><title>Supervisor</title><link href="https://richardrobot.xyz/2021/10/mac-supervisor/" rel="alternate"></link><published>2021-10-05T19:22:00+08:00</published><updated>2021-10-05T19:22:00+08:00</updated><author><name>Richard</name></author><id>tag:richardrobot.xyz,2021-10-05:/2021/10/mac-supervisor/</id><summary type="html">&lt;p&gt;在Mac上使用supervisor來啓動服務&lt;/p&gt;</summary><content type="html">&lt;p&gt;在 Linux上可以使用systemctl&amp;nbsp;這個服務來開機就能自動啓動寫好的網站服務，等等其他的，但是在Mac上卻無法，使用supervisor還有Web畫面可以查看&lt;/p&gt;
&lt;p&gt;&lt;img alt="Supervisor服務畫面.png" src="https://richardrobot.xyz/images/Supervisor服務畫面.png" /&gt;&lt;/p&gt;
&lt;h2 id="brew"&gt;透過brew來安裝：&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;brew install supervisor&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="_1"&gt;設定檔路徑：&lt;/h3&gt;
&lt;p&gt;由於是Mac M1 的系統，homebrew已經將設定的路徑放在 &lt;code&gt;/opt/homebrew/etc&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;如下圖，開啓 supervisor.conf&amp;nbsp;檔案&lt;/p&gt;
&lt;p&gt;&lt;img alt="supervisor的ini設定畫面.png" src="https://richardrobot.xyz/images/supervisor的ini設定畫面.png" /&gt;&lt;/p&gt;
&lt;p&gt;可以註解前面的 &lt;code&gt;;&lt;/code&gt; 符號來啓用設定&amp;nbsp;:&lt;/p&gt;
&lt;p&gt;可以開啓 Web的畫面 啓用 登入帳號密碼
&lt;code&gt;python
[inet_http_server]          ; inet (TCP) server disabled by default
port=127.0.0.1:9001         ; ip_address:port specifier, *:port for all iface
username=test               ; default is no username (open server)
password=123                ; default is no password (open server)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;在最後加入客製化的設定檔：
加入下面的設定，可以在/Process/  資料夾底下設定需要的Service檔，並且用 .ini&amp;nbsp;爲副檔名&lt;/p&gt;
&lt;p&gt;&lt;span class="dquo"&gt;&amp;#8220;&lt;/span&gt;`java
[include]
files =&amp;nbsp;/Users/jarvis.zheng/Process/*.ini&lt;/p&gt;
&lt;p&gt;&lt;span class="dquo"&gt;&amp;#8220;&lt;/span&gt;`&lt;/p&gt;
&lt;p&gt;已django網站爲例：&lt;/p&gt;
&lt;p&gt;command 程序啓動命令：使用gunicorn來當WebServer，使用參數檔 gunicorn.conf.py&amp;nbsp;&amp;#8220;`python&lt;/p&gt;
&lt;p&gt;[program:django_server]
command=/Users/jarvis.zheng/miniforge3/envs/finlab/bin/gunicorn -c gunicorn.conf.py StockSecretary.wsgi
process_name=%(program_name)s&amp;nbsp;directory=/Users/jarvis.zheng/StockWeb/&lt;/p&gt;
&lt;p&gt;&lt;span class="dquo"&gt;&amp;#8220;&lt;/span&gt;`&lt;/p&gt;
&lt;p&gt;啓動服務：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;python
sudo brew services start supervisor&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;參考資料：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://hoohoo.top/blog/supervisor-instructions-for-use/"&gt;&lt;span class="caps"&gt;SUPERVISOR&lt;/span&gt;&amp;nbsp;介紹與使用方式&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://aptro.github.io/server/architecture/2016/06/21/Jupyter-Notebook-Nginx-Setup.html"&gt;Jupyter Notebook and Nginx&amp;nbsp;Setup&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.gushiciku.cn/pl/2MVd/zh-tw"&gt;Mac &lt;span class="caps"&gt;OSX&lt;/span&gt; 開機啟動應用&amp;nbsp;(supervisor)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.twblogs.net/a/5d6115a6bd9eee541c32bb6f"&gt;Python Tricks —— 使用 Supervisor 控制 Linux&amp;nbsp;進程&lt;/a&gt;&lt;/p&gt;</content><category term="Mac"></category><category term="Mac"></category><category term="Supervisor"></category><category term="Nginx"></category></entry><entry><title>副檔名command無法執行</title><link href="https://richardrobot.xyz/2021/10/mac-command-permission/" rel="alternate"></link><published>2021-10-01T11:47:00+08:00</published><updated>2021-10-01T11:47:00+08:00</updated><author><name>Richard</name></author><id>tag:richardrobot.xyz,2021-10-01:/2021/10/mac-command-permission/</id><summary type="html">&lt;p&gt;寫好了可以執行的發佈語法，點擊執行卻出現這個&lt;/p&gt;</summary><content type="html">&lt;p&gt;寫好了可以執行的發佈語法，點擊執行卻出現這個&lt;/p&gt;
&lt;p&gt;&lt;img alt="副檔名command無法執行.png" src="https://richardrobot.xyz/images/副檔名command無法執行.png" /&gt;&lt;/p&gt;
&lt;p&gt;需要另外給予權限：&lt;code&gt;chmod +x batch_notes_script.command&lt;/code&gt;&lt;/p&gt;</content><category term="Mac"></category><category term="權限問題"></category></entry></feed>