<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Richard隨手筆記 - GoogleCloudPlatform</title><link href="https://richardrobot.xyz/" rel="alternate"></link><link href="https://richardrobot.xyz/feeds/googlecloudplatform.atom.xml" rel="self"></link><id>https://richardrobot.xyz/</id><updated>2021-12-01T15:57:00+08:00</updated><subtitle>紙上得來終覺淺，絕知此事要躬行</subtitle><entry><title>使用vncserver建立遠端管理GCP與內容管理系統建置</title><link href="https://richardrobot.xyz/2020/12/vncserver-gcp/" rel="alternate"></link><published>2020-12-01T15:57:00+08:00</published><updated>2021-12-01T15:57:00+08:00</updated><author><name>Richard</name></author><id>tag:richardrobot.xyz,2020-12-01:/2020/12/vncserver-gcp/</id><summary type="html">&lt;p&gt;使用vncserver建立遠端管理GCP與架設內容管理系統站臺&lt;/p&gt;</summary><content type="html">
&lt;p&gt;這篇文章是從頭建立起GCP網站，與遠端連線的方法
1. 使用VNC Server來遠端桌面連線，因為有許多需要修改設定檔需要遠端執行
2. 站臺的建立方式WebServer是用Nginx+Gunicorn ，Python的站臺程式用WagtailCMS&lt;/p&gt;
&lt;h2 id="vnc-servergcp"&gt;&lt;span class="caps"&gt;VNC&lt;/span&gt; Server建立可遠端桌面連線GCP&lt;a class="headerlink" href="#vnc-servergcp" title="Permanent link"&gt;¶&lt;/a&gt;&lt;/h2&gt;
&lt;hr/&gt;
&lt;p&gt;首先，先在GCP建立Compute Engine的VM執行個體，VM的執行個體系統選擇Ubuntu，再將外部IP改為靜態IP&lt;/p&gt;
&lt;p&gt;&lt;img alt="VM設定靜態IP.png" src="https://richardrobot.xyz/images/VM設定靜態IP.png"/&gt;
&lt;img alt="VM設定靜態IP2.png" src="https://richardrobot.xyz/images/VM設定靜態IP2.png"/&gt;&lt;/p&gt;
&lt;p&gt;使用平臺提供的瀏覽器Terminal&lt;/p&gt;
&lt;p&gt;&lt;img alt="使用平臺提供的瀏覽器Terminal.png" src="https://richardrobot.xyz/images/使用平臺提供的瀏覽器Terminal.png"/&gt;
&lt;img alt="使用平臺提供的瀏覽器Terminal2.png" src="https://richardrobot.xyz/images/使用平臺提供的瀏覽器Terminal2.png"/&gt;&lt;/p&gt;
&lt;p&gt;安裝一些必要的套件，並且執行 vnc4server 執行語法:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo apt-get update &amp;amp;&amp;amp; sudo apt-get upgrade&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo apt-get install ubuntu-desktop gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo apt-get install vnc4server&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vnc4server&lt;/code&gt;&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;&lt;img alt="安裝與執行vnc4server.png" src="https://richardrobot.xyz/images/安裝與執行vnc4server.png"/&gt;&lt;/p&gt;
&lt;h3 id="vncxstartup"&gt;修改~/.vnc/xstartup 的設定&lt;a class="headerlink" href="#vncxstartup" title="Permanent link"&gt;¶&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;輸入語法：
&lt;code&gt;sudo vim .vnc/xstartup&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;進入如下畫面： 畫面是使用ubuntu的內建vim編輯器&lt;/p&gt;
&lt;p&gt;&lt;img alt="畫面是使用ubuntu的內建vim編輯器.png" src="https://richardrobot.xyz/images/畫面是使用ubuntu的內建vim編輯器.png"/&gt;&lt;/p&gt;
&lt;p&gt;按 I 進入編輯模式 貼上四行語法&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;gnome&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;panel&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;
&lt;span class="n"&gt;gnome&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;daemon&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;
&lt;span class="n"&gt;metacity&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;
&lt;span class="n"&gt;nautilus&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;再輸入 :wq 儲存退出&lt;/p&gt;
&lt;p&gt;輸入語法
&lt;code&gt;vncserver -kill :1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vncserver :1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;以上完成vncserver建立，可遠端桌面連線了 &lt;/p&gt;
&lt;p&gt;GCP需要開啟防火牆 指定 &lt;span class="caps"&gt;PORT&lt;/span&gt; 5901&lt;/p&gt;
&lt;p&gt;&lt;img alt="GCP需要開啟防火牆.png" src="https://richardrobot.xyz/images/GCP需要開啟防火牆.png"/&gt;&lt;/p&gt;
&lt;h3 id="realvnc-viewer"&gt;下載RealVNC Viewer&lt;a class="headerlink" href="#realvnc-viewer" title="Permanent link"&gt;¶&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;輸入 35.229.134.113:5901 連線，這個連線IP就是當初建立VM的外部靜態IP&lt;/p&gt;
&lt;p&gt;&lt;img alt="下載RealVNC.png" src="https://richardrobot.xyz/images/下載RealVNC.png"/&gt;
&lt;img alt="下載RealVNC2.png" src="https://richardrobot.xyz/images/下載RealVNC2.png"/&gt;&lt;/p&gt;
&lt;p&gt;可遠端桌面連線是方便以後程式建置時，資料架構查看或上傳程式方便&lt;/p&gt;
&lt;h2 id="google-cloudubuntu-postgresnginxgunicorndjango"&gt;如何在Google Cloud中的Ubuntu 上使用Postgres，Nginx和Gunicorn設置Django&lt;a class="headerlink" href="#google-cloudubuntu-postgresnginxgunicorndjango" title="Permanent link"&gt;¶&lt;/a&gt;&lt;/h2&gt;
&lt;hr/&gt;
&lt;p&gt;前置準備：
1. 您的Compute Engine實例正在運行，請參閱設置Compute Engine實例。
2. 域名指向您的虛擬機。（此Domain我已先設定FreeDNS：gcp.mooo.com 暫時的設定，到時候申請好正式的Domain再修改）
3. 有關設置Cloud DNS的信息，請參閱為您的域設置Google Cloud &lt;span class="caps"&gt;DNS&lt;/span&gt;。&lt;/p&gt;
&lt;p&gt;在一樣剛剛的GCP Terminal安裝以下套件
執行語法：
&lt;code&gt;sudo apt update&lt;/code&gt;
&lt;code&gt;sudo apt install python3-pip python3-dev libpq-dev postgresql-contrib nginx curl&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="安裝套件跟postgresql.png" src="https://richardrobot.xyz/images/安裝套件跟postgresql.png"/&gt;&lt;/p&gt;
&lt;p&gt;如下圖，在GCP的操作功能上找SQL，並且產生Cloud SQL執行個體&lt;/p&gt;
&lt;p&gt;&lt;img alt="建立GCP的SQL資料庫.png" src="https://richardrobot.xyz/images/建立GCP的SQL資料庫.png"/&gt;&lt;/p&gt;
&lt;p&gt;位置區域要跟VM的位置區域一樣&lt;/p&gt;
&lt;p&gt;&lt;img alt="位置區域要跟VM的位置區域一樣.png" src="https://richardrobot.xyz/images/位置區域要跟VM的位置區域一樣.png"/&gt;&lt;/p&gt;
&lt;p&gt;建立SQL後，下面顯示的公開IP是到時候程式Django站臺連線需要&lt;/p&gt;
&lt;p&gt;&lt;img alt="建立SQL後下面顯示的公開IP是到時候程式連線需要.png" src="https://richardrobot.xyz/images/建立SQL後下面顯示的公開IP是到時候程式連線需要.png"/&gt;&lt;/p&gt;
&lt;p&gt;編輯連線設定：設定只有VM的IP可以連線，填入GCP的靜態外部IP&lt;/p&gt;
&lt;p&gt;&lt;img alt="編輯連線設定設定只有VM的IP可以連線.png" src="https://richardrobot.xyz/images/編輯連線設定設定只有VM的IP可以連線.png"/&gt;&lt;/p&gt;
&lt;p&gt;上面建立好資料庫後，開始建立VM上面Django的專案&lt;/p&gt;
&lt;h2 id="vmwagtailcms"&gt;建立VM上面WagtailCMS的專案&lt;a class="headerlink" href="#vmwagtailcms" title="Permanent link"&gt;¶&lt;/a&gt;&lt;/h2&gt;
&lt;hr/&gt;
&lt;p&gt;接下來就開始是安裝與建立內容管理系統的部分，與GCP的設定大部分已完成。
關於內容管理系統的試用分享可查看： &lt;a href="https://richardrobot.xyz/2021/12/python-cms/"&gt;內容管理系統CMS&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;建構的流程
1. 建立Python的虛擬環境
2. 安裝套裝程式:Django gunicorn coderedcms 
3. 設定連線字串
4. 執行 python manage.py migrate 初始化
5. 建立Gunicorn 連接起程式
6. 設定Nginx的設定檔&lt;/p&gt;
&lt;h3 id="python"&gt;建立Python的虛擬環境&lt;a class="headerlink" href="#python" title="Permanent link"&gt;¶&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;執行語法：（下面的語法含義可看文章說明）
安裝虛擬環境
&lt;code&gt;sudo -H pip3 install --upgrade pip&lt;/code&gt;
&lt;code&gt;sudo -H pip3 install virtualenv&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;建立名為WagtailDir 資料夾，並且創建虛擬環境，切換環境
&lt;code&gt;mkdir ~/WagtailDir&lt;/code&gt;
&lt;code&gt;cd ~/WagtailDir&lt;/code&gt;
&lt;code&gt;virtualenv WagtailEnv&lt;/code&gt;
&lt;code&gt;source WagtailEnv/bin/activate&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;下圖是建立資料夾與python的虛擬環境&lt;/p&gt;
&lt;p&gt;&lt;img alt="建立資料夾與python的虛擬環境.png" src="https://richardrobot.xyz/images/建立資料夾與python的虛擬環境.png"/&gt;&lt;/p&gt;
&lt;h3 id="django-gunicorn-coderedcms"&gt;安裝套裝程式:Django gunicorn coderedcms&lt;a class="headerlink" href="#django-gunicorn-coderedcms" title="Permanent link"&gt;¶&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;執行語法
&lt;code&gt;pip install django gunicorn psycopg2-binary&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;pip install coderedcms&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;coderedcms start WagtailProject --sitename "網站名稱"&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;上面是建立Django專案的語法，還有CodeRed &lt;span class="caps"&gt;CMS&lt;/span&gt; 的套件，從VNC Viewer可看到資料夾&lt;/p&gt;
&lt;p&gt;&lt;img alt="還有CodeRed CMS 的套從VNC Viewer可看到資料夾.png" src="https://richardrobot.xyz/images/還有CodeRed CMS 的套從VNC Viewer可看到資料夾.png"/&gt;
&lt;img alt="還有CodeRed CMS 的套從VNC Viewer可看到資料夾2.png" src="https://richardrobot.xyz/images/還有CodeRed CMS 的套從VNC Viewer可看到資料夾2.png"/&gt;&lt;/p&gt;
&lt;h3 id="_1"&gt;設定連線字串&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;¶&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;修改連線字串：連線字串在 /settings/base.py&lt;/p&gt;
&lt;p&gt;&lt;img alt="修改連線字串連線字串在basepy.png" src="https://richardrobot.xyz/images/修改連線字串連線字串在basepy.png"/&gt;&lt;/p&gt;
&lt;p&gt;連線字串的修改相關名稱設定可參考Django的連線設定，連線字串的使用者與密碼就是前面在GCP設定的&lt;/p&gt;
&lt;p&gt;&lt;img alt="連線字串與使用者是上面在GCE設定的.png" src="https://richardrobot.xyz/images/連線字串與使用者是上面在GCE設定的.png"/&gt;&lt;/p&gt;
&lt;p&gt;上面連線字串修改好是連線遠端SQL的資料庫後，接下來的語法執行就開始建立資料庫的Table與 Schema&lt;/p&gt;
&lt;h3 id="python-managepy-migrate"&gt;執行 python manage.py migrate 初始化&lt;a class="headerlink" href="#python-managepy-migrate" title="Permanent link"&gt;¶&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;img alt="開始建立資料庫的Table與Schema.png" src="https://richardrobot.xyz/images/開始建立資料庫的Table與Schema.png"/&gt;&lt;/p&gt;
&lt;p&gt;執行語法：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;cd&lt;/span&gt; &lt;span class="n"&gt;WagtailProject&lt;/span&gt;
&lt;span class="n"&gt;python&lt;/span&gt; &lt;span class="n"&gt;manage&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;py&lt;/span&gt; &lt;span class="n"&gt;migrate&lt;/span&gt;
&lt;span class="n"&gt;python&lt;/span&gt; &lt;span class="n"&gt;manage&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;py&lt;/span&gt; &lt;span class="n"&gt;makemigrations&lt;/span&gt;
&lt;span class="n"&gt;python&lt;/span&gt; &lt;span class="n"&gt;manage&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;py&lt;/span&gt; &lt;span class="n"&gt;createsuperuser&lt;/span&gt;
&lt;span class="n"&gt;python&lt;/span&gt; &lt;span class="n"&gt;manage&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;py&lt;/span&gt; &lt;span class="n"&gt;runserver&lt;/span&gt;
&lt;span class="n"&gt;python&lt;/span&gt; &lt;span class="n"&gt;manage&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;py&lt;/span&gt; &lt;span class="n"&gt;collectstatic&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;看到以下畫面有顯示 http://127.0.0.1:8000 表示已經在本機跑起來一個Application Web Server&lt;/p&gt;
&lt;p&gt;&lt;img alt="看到以下畫面有顯示表示已經在本機跑起來.png" src="https://richardrobot.xyz/images/看到以下畫面有顯示表示已經在本機跑起來.png"/&gt;&lt;/p&gt;
&lt;h3 id="gunicorn"&gt;建立Gunicorn 連接起程式&lt;a class="headerlink" href="#gunicorn" title="Permanent link"&gt;¶&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;接下來建立Gunicorn 連接起程式
執行語法：
&lt;code&gt;sudo vim /etc/systemd/system/gunicorn.socket&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="建立Gunicorn連接起程式.png" src="https://richardrobot.xyz/images/建立Gunicorn連接起程式.png"/&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo vim /etc/systemd/system/gunicorn.service&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="建立Gunicorn連接起程式2.png" src="https://richardrobot.xyz/images/建立Gunicorn連接起程式2.png"/&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Unit&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;gunicorn&lt;/span&gt; &lt;span class="n"&gt;daemon&lt;/span&gt;
&lt;span class="n"&gt;Requires&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;gunicorn&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;
&lt;span class="n"&gt;After&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;network&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;

&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Service&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;User&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;sutsagent&lt;/span&gt;
&lt;span class="n"&gt;Group&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;sutsagent&lt;/span&gt;
&lt;span class="n"&gt;WorkingDirectory&lt;/span&gt;&lt;span class="o"&gt;=/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sutsagent&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;WagtailDir&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;WagtailProject&lt;/span&gt;
&lt;span class="n"&gt;ExecStart&lt;/span&gt;&lt;span class="o"&gt;=/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sutsagent&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;WagtailDir&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;WagtailEnv&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nb"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;gunicorn&lt;/span&gt; \
     &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;access&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;logfile&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; \
     &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;workers&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt; \
     &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt; &lt;span class="n"&gt;unix&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;gunicorn&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt; \
     &lt;span class="n"&gt;WagtailProject&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;wsgi&lt;/span&gt;

&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Install&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;multi&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;最後執行一些啟動，重啟與狀態查看&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;systemctl&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt; &lt;span class="n"&gt;gunicorn&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;
&lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;systemctl&lt;/span&gt; &lt;span class="n"&gt;enable&lt;/span&gt; &lt;span class="n"&gt;gunicorn&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;
&lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;systemctl&lt;/span&gt; &lt;span class="n"&gt;status&lt;/span&gt; &lt;span class="n"&gt;gunicorn&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;
&lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;gunicorn&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt;
&lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;systemctl&lt;/span&gt; &lt;span class="n"&gt;status&lt;/span&gt; &lt;span class="n"&gt;gunicorn&lt;/span&gt;
&lt;span class="n"&gt;curl&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;unix&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;gunicorn&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sock&lt;/span&gt; &lt;span class="n"&gt;localhost&lt;/span&gt;
&lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;systemctl&lt;/span&gt; &lt;span class="n"&gt;status&lt;/span&gt; &lt;span class="n"&gt;gunicorn&lt;/span&gt;
&lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;systemctl&lt;/span&gt; &lt;span class="n"&gt;daemon&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;reload&lt;/span&gt;
&lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;systemctl&lt;/span&gt; &lt;span class="n"&gt;restart&lt;/span&gt; &lt;span class="n"&gt;gunicorn&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id="nginx"&gt;設定Nginx的設定檔&lt;a class="headerlink" href="#nginx" title="Permanent link"&gt;¶&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;設定Nginx，建立一個自定義名稱設定檔，我定義為 gcp.mooo.com&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo vim /etc/nginx/sites-available/gcp.mooo.com&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Nginx的一些設定，主要設定server_name要對應自己的Domain，與location的路徑&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;server&lt;/span&gt; 
&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;listen&lt;/span&gt; &lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;listen&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;server_name&lt;/span&gt; &lt;span class="n"&gt;gcp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mooo&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt; &lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;gcp&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mooo&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;location&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;favicon&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ico&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;access_log&lt;/span&gt; &lt;span class="n"&gt;off&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="n"&gt;log_not_found&lt;/span&gt; &lt;span class="n"&gt;off&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="n"&gt;location&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;static&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;root&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sutsagent&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;WagtailDir&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;WagtailProject&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="n"&gt;location&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;include&lt;/span&gt; &lt;span class="n"&gt;proxy_params&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="n"&gt;proxy_pass&lt;/span&gt; &lt;span class="nl"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;//unix:/run/gunicorn.sock;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;最後：將檔案連結到啟動網站的目錄來啟動該檔案
&lt;code&gt;sudo ln -s /etc/nginx/sites-available/pgcp.mooo.com /etc/nginx/sites-enabled&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;執行最後語法：測試nginx與重啟&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;nginx&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;
&lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="n"&gt;nginx&lt;/span&gt; &lt;span class="n"&gt;restart&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id="_2"&gt;後續&lt;a class="headerlink" href="#_2" title="Permanent link"&gt;¶&lt;/a&gt;&lt;/h2&gt;
&lt;hr/&gt;
&lt;p&gt;後續開發都是使用VSCode，發現使用Remote SSH連線遠端直接修改設定檔還比較快
另外記錄使用方式： &lt;a href="{filename}/程式語言/微軟/使用VSCode遠端SSH開發.md"&gt;使用VSCode遠端SSH開發&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;參考資料：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://medium.com/@huiqinng/%E7%AD%86%E8%A8%98-%E5%9C%A8gcp%E4%B8%8A%E5%BB%BA%E7%AB%8B%E5%8F%AFremote-dekstop%E7%9A%84ubuntu%E7%92%B0%E5%A2%83-e56fdbd3a4f2"&gt;【筆記】在GCP上建立可Remote dekstop的Ubuntu環境&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://infinitewing.github.io/2017/08/13/20170813001/"&gt;在GCP開啟Ubuntu遠端桌面&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.cloudbooklet.com/how-to-set-up-django-with-postgres-nginx-and-gunicorn-on-ubuntu-18-04-in-google-cloud/"&gt;How To Set Up Django with Postgres, Nginx, and Gunicorn on Ubuntu 18.04 in Google Cloud&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://medium.com/tsungs-blog/django-%E5%9C%A8ubuntu%E4%B8%AD%E9%81%8B%E7%94%A8nginx-gunicorn-%E6%9E%B6%E8%A8%AD-django-api-server-6d41c165a2c7"&gt;[Django] 在Ubuntu中運用Nginx、Gunicorn 架設 Django &lt;span class="caps"&gt;API&lt;/span&gt; Server&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="GoogleCloudPlatform"></category><category term="GoogleCloudPlatform"></category><category term="WagtailCMS"></category></entry></feed>